<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Storage Integration Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #ddd;
            background: #fafafa;
        }
        .test-item.success {
            border-color: #4CAF50;
            background: #f1f8f4;
        }
        .test-item.error {
            border-color: #f44336;
            background: #fef1f0;
        }
        .test-item.pending {
            border-color: #ff9800;
            background: #fff8f0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .provider-card {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            min-width: 200px;
        }
        .provider-card.connected {
            border-color: #4CAF50;
            background: #f1f8f4;
        }
        .log {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .file-list {
            list-style: none;
            padding: 0;
        }
        .file-list li {
            padding: 8px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.pending { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <h1>üöÄ Cloud Storage Integration Test Suite</h1>
    
    <div class="test-section">
        <h2>üìã Environment Check</h2>
        <div id="env-check" class="test-item pending">
            <strong>Checking environment variables...</strong>
            <div class="log" id="env-log"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>‚òÅÔ∏è Provider Connection Test</h2>
        <div id="providers">
            <div class="provider-card" data-provider="google-drive">
                <h3>Google Drive</h3>
                <button onclick="testProvider('google-drive')">Test Connection</button>
                <div class="status pending">Not tested</div>
            </div>
            <div class="provider-card" data-provider="dropbox">
                <h3>Dropbox</h3>
                <button onclick="testProvider('dropbox')">Test Connection</button>
                <div class="status pending">Not tested</div>
            </div>
            <div class="provider-card" data-provider="onedrive">
                <h3>OneDrive</h3>
                <button onclick="testProvider('onedrive')">Test Connection</button>
                <div class="status pending">Not tested</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìÅ File Operations Test</h2>
        <button onclick="testFileUpload()">Test Upload</button>
        <button onclick="testFileDownload()">Test Download</button>
        <button onclick="testFileList()">Test List Files</button>
        <button onclick="testFileSearch()">Test Search</button>
        <div class="log" id="file-log"></div>
        <ul class="file-list" id="file-list"></ul>
    </div>

    <div class="test-section">
        <h2>üíæ Cache Test</h2>
        <button onclick="testCache()">Test IndexedDB Cache</button>
        <button onclick="testOfflineMode()">Test Offline Mode</button>
        <button onclick="clearCache()">Clear Cache</button>
        <div class="log" id="cache-log"></div>
    </div>

    <div class="test-section">
        <h2>üîÑ Sync Test</h2>
        <button onclick="testSync()">Test Sync Queue</button>
        <button onclick="simulateOffline()">Simulate Offline</button>
        <button onclick="simulateOnline()">Simulate Online</button>
        <div class="log" id="sync-log"></div>
    </div>

    <div class="test-section">
        <h2>üìä Test Results</h2>
        <div id="results">
            <p>Total Tests: <span id="total-tests">0</span></p>
            <p>Passed: <span id="passed-tests" style="color: green;">0</span></p>
            <p>Failed: <span id="failed-tests" style="color: red;">0</span></p>
            <p>Pending: <span id="pending-tests" style="color: orange;">0</span></p>
        </div>
    </div>

    <script>
        // Test state
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            pending: 0
        };

        // Logging helper
        function log(elementId, message, type = 'info') {
            const logElement = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Update test results
        function updateResults(status) {
            testResults.total++;
            if (status === 'success') testResults.passed++;
            else if (status === 'error') testResults.failed++;
            else testResults.pending++;
            
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;
            document.getElementById('pending-tests').textContent = testResults.pending;
        }

        // Environment check
        async function checkEnvironment() {
            const envCheck = document.getElementById('env-check');
            const requiredVars = [
                'NEXT_PUBLIC_GOOGLE_DRIVE_CLIENT_ID',
                'NEXT_PUBLIC_DROPBOX_CLIENT_ID',
                'NEXT_PUBLIC_ONEDRIVE_CLIENT_ID'
            ];
            
            let allPresent = true;
            requiredVars.forEach(varName => {
                // In a real app, you'd check process.env or make an API call
                const present = localStorage.getItem(varName) !== null;
                log('env-log', `${varName}: ${present ? '‚úì' : '‚úó'}`, present ? 'success' : 'error');
                if (!present) allPresent = false;
            });
            
            if (allPresent) {
                envCheck.className = 'test-item success';
                envCheck.querySelector('strong').textContent = '‚úì Environment variables configured';
                updateResults('success');
            } else {
                envCheck.className = 'test-item error';
                envCheck.querySelector('strong').textContent = '‚úó Missing environment variables';
                updateResults('error');
            }
        }

        // Test provider connection
        async function testProvider(provider) {
            const card = document.querySelector(`[data-provider="${provider}"]`);
            const statusElement = card.querySelector('.status');
            
            statusElement.textContent = 'Testing...';
            statusElement.className = 'status pending';
            
            try {
                // Simulate provider test (in real app, would call storageManager)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simulate success/failure
                const success = Math.random() > 0.3;
                
                if (success) {
                    card.classList.add('connected');
                    statusElement.textContent = 'Connected';
                    statusElement.className = 'status success';
                    updateResults('success');
                    log('file-log', `${provider} connected successfully`, 'success');
                } else {
                    statusElement.textContent = 'Failed';
                    statusElement.className = 'status error';
                    updateResults('error');
                    log('file-log', `${provider} connection failed`, 'error');
                }
            } catch (error) {
                statusElement.textContent = 'Error';
                statusElement.className = 'status error';
                updateResults('error');
                log('file-log', `${provider} error: ${error.message}`, 'error');
            }
        }

        // Test file upload
        async function testFileUpload() {
            log('file-log', 'Testing file upload...', 'info');
            
            try {
                // Create test file
                const blob = new Blob(['Test file content'], { type: 'text/plain' });
                const file = new File([blob], 'test-file.txt', { type: 'text/plain' });
                
                // Simulate upload
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                log('file-log', 'File uploaded successfully: test-file.txt', 'success');
                updateResults('success');
                
                // Add to file list
                const fileList = document.getElementById('file-list');
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>test-file.txt</span>
                    <button onclick="testFileDownload('test-file.txt')">Download</button>
                `;
                fileList.appendChild(li);
            } catch (error) {
                log('file-log', `Upload failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Test file download
        async function testFileDownload(filename = 'test-file.txt') {
            log('file-log', `Testing file download: ${filename}...`, 'info');
            
            try {
                // Simulate download
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Create download link
                const blob = new Blob(['Downloaded content'], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                
                log('file-log', `File downloaded: ${filename}`, 'success');
                updateResults('success');
            } catch (error) {
                log('file-log', `Download failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Test file list
        async function testFileList() {
            log('file-log', 'Fetching file list...', 'info');
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const files = [
                    { name: 'document.pdf', size: '2.4 MB' },
                    { name: 'image.jpg', size: '1.2 MB' },
                    { name: 'data.xlsx', size: '542 KB' }
                ];
                
                const fileList = document.getElementById('file-list');
                fileList.innerHTML = '';
                
                files.forEach(file => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${file.name} (${file.size})</span>
                        <button onclick="testFileDownload('${file.name}')">Download</button>
                    `;
                    fileList.appendChild(li);
                });
                
                log('file-log', `Listed ${files.length} files`, 'success');
                updateResults('success');
            } catch (error) {
                log('file-log', `List failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Test file search
        async function testFileSearch() {
            const query = prompt('Enter search query:', 'test');
            if (!query) return;
            
            log('file-log', `Searching for: ${query}...`, 'info');
            
            try {
                // Simulate search
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log('file-log', `Found 3 results for "${query}"`, 'success');
                updateResults('success');
            } catch (error) {
                log('file-log', `Search failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Test cache
        async function testCache() {
            log('cache-log', 'Testing IndexedDB cache...', 'info');
            
            try {
                // Open IndexedDB
                const request = indexedDB.open('storage-cache', 1);
                
                request.onsuccess = () => {
                    log('cache-log', 'IndexedDB opened successfully', 'success');
                    
                    // Test storing data
                    const db = request.result;
                    const transaction = db.transaction(['files'], 'readwrite');
                    const store = transaction.objectStore('files');
                    
                    store.add({
                        id: 'test-' + Date.now(),
                        name: 'cached-file.txt',
                        cached: true
                    });
                    
                    log('cache-log', 'Cache write successful', 'success');
                    updateResults('success');
                };
                
                request.onerror = () => {
                    log('cache-log', 'IndexedDB error', 'error');
                    updateResults('error');
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('files')) {
                        db.createObjectStore('files', { keyPath: 'id' });
                    }
                };
            } catch (error) {
                log('cache-log', `Cache test failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Test offline mode
        function testOfflineMode() {
            log('cache-log', 'Testing offline mode...', 'info');
            
            // Simulate offline
            if ('onLine' in navigator) {
                log('cache-log', `Network status: ${navigator.onLine ? 'Online' : 'Offline'}`, 'info');
                
                if (!navigator.onLine) {
                    log('cache-log', 'Operating in offline mode - using cache', 'success');
                } else {
                    log('cache-log', 'Currently online - switch to offline to test', 'info');
                }
                updateResults('success');
            } else {
                log('cache-log', 'Offline detection not supported', 'error');
                updateResults('error');
            }
        }

        // Clear cache
        async function clearCache() {
            log('cache-log', 'Clearing cache...', 'info');
            
            try {
                const dbs = await indexedDB.databases();
                for (const db of dbs) {
                    indexedDB.deleteDatabase(db.name);
                }
                
                localStorage.clear();
                
                log('cache-log', 'Cache cleared successfully', 'success');
                updateResults('success');
            } catch (error) {
                log('cache-log', `Clear cache failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Test sync
        async function testSync() {
            log('sync-log', 'Testing sync queue...', 'info');
            
            try {
                // Simulate queued operations
                const operations = [
                    { type: 'upload', file: 'file1.txt', status: 'pending' },
                    { type: 'delete', file: 'file2.txt', status: 'pending' },
                    { type: 'rename', file: 'file3.txt', status: 'pending' }
                ];
                
                log('sync-log', `Found ${operations.length} pending operations`, 'info');
                
                for (const op of operations) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    log('sync-log', `Synced: ${op.type} ${op.file}`, 'success');
                }
                
                log('sync-log', 'All operations synced', 'success');
                updateResults('success');
            } catch (error) {
                log('sync-log', `Sync failed: ${error.message}`, 'error');
                updateResults('error');
            }
        }

        // Simulate offline
        function simulateOffline() {
            log('sync-log', 'Simulating offline mode...', 'info');
            window.dispatchEvent(new Event('offline'));
            log('sync-log', 'Now offline - operations will be queued', 'info');
        }

        // Simulate online
        function simulateOnline() {
            log('sync-log', 'Simulating online mode...', 'info');
            window.dispatchEvent(new Event('online'));
            log('sync-log', 'Now online - syncing queued operations', 'success');
            testSync();
        }

        // Initialize tests
        window.onload = () => {
            checkEnvironment();
            
            // Listen for online/offline events
            window.addEventListener('online', () => {
                log('sync-log', 'Connection restored', 'success');
            });
            
            window.addEventListener('offline', () => {
                log('sync-log', 'Connection lost', 'error');
            });
        };
    </script>
</body>
</html>
